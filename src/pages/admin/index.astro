---
import site from '../../content/site.json';
import fences from '../../content/fences.json';
import reviews from '../../content/reviews.json';
const firebaseConfig = {
  apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
  authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.PUBLIC_FIREBASE_APP_ID
};
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Ghareeb Fencing Solutions</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary:#1e3a5f;--primary-dark:#152a45;--accent:#d4af37;--success:#10b981;--warning:#f59e0b;--error:#ef4444;--bg:#f8fafc;--text:#1e293b;--text-muted:#64748b;--border:#e2e8f0;--radius:8px;--shadow:0 1px 3px rgba(0,0,0,0.1);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1); }
        *{margin:0;padding:0;box-sizing:border-box;} body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}
        .login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));}.login-screen.hidden{display:none;}
        .login-card{background:white;padding:48px;border-radius:16px;box-shadow:var(--shadow-lg);width:100%;max-width:400px;text-align:center;}
        .login-logo{font-size:1.5rem;font-weight:700;color:var(--primary);margin-bottom:8px;}.login-logo span{color:var(--accent);}
        .login-subtitle{color:var(--text-muted);margin-bottom:32px;}.login-form{display:flex;flex-direction:column;gap:16px;}
        .login-error{background:#fee2e2;color:#dc2626;padding:12px;border-radius:var(--radius);font-size:0.875rem;display:none;}
        .form-group{margin-bottom:16px;}.form-group label{display:block;font-size:0.875rem;font-weight:600;margin-bottom:6px;}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:var(--radius);font-size:1rem;transition:border-color 0.2s;font-family:inherit;}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary);}
        .form-group textarea{min-height:100px;resize:vertical;}.form-group .help-text{font-size:0.8rem;color:var(--text-muted);margin-top:4px;}
        .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;border:none;border-radius:var(--radius);font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.2s;text-decoration:none;}
        .btn:disabled{opacity:0.5;cursor:not-allowed;}.btn-primary{background:var(--primary);color:white;}.btn-primary:hover:not(:disabled){background:var(--primary-dark);}
        .btn-success{background:var(--success);color:white;}.btn-danger{background:var(--error);color:white;}
        .btn-outline{background:white;border:2px solid var(--border);color:var(--text);}.btn-outline:hover:not(:disabled){border-color:var(--primary);color:var(--primary);}
        .btn-sm{padding:8px 16px;font-size:0.875rem;}.btn-xs{padding:4px 10px;font-size:0.75rem;}.btn-block{width:100%;}
        .btn-logout{background:transparent;color:var(--text-muted);padding:8px 16px;}
        .dashboard{display:none;min-height:100vh;}.dashboard.active{display:flex;}
        .sidebar{width:260px;background:var(--primary);color:white;padding:24px 0;display:flex;flex-direction:column;position:fixed;height:100vh;overflow-y:auto;z-index:200;}
        .sidebar-logo{padding:0 24px 24px;border-bottom:1px solid rgba(255,255,255,0.1);}.sidebar-logo h1{font-size:1.25rem;font-weight:700;}.sidebar-logo h1 span{color:var(--accent);}
        .sidebar-logo p{font-size:0.75rem;color:rgba(255,255,255,0.6);margin-top:4px;}
        .sidebar nav{flex:1;padding:16px 0;}.nav-section{margin-bottom:8px;}
        .nav-section-title{font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:rgba(255,255,255,0.4);padding:8px 24px;}
        .nav-link{display:flex;align-items:center;gap:12px;padding:12px 24px;color:rgba(255,255,255,0.7);text-decoration:none;transition:all 0.2s;cursor:pointer;font-size:0.9rem;}
        .nav-link:hover{background:rgba(255,255,255,0.1);color:white;}.nav-link.active{background:rgba(255,255,255,0.15);color:white;border-left:3px solid var(--accent);}
        .nav-link svg{width:20px;height:20px;flex-shrink:0;}
        .nav-note{font-size:0.7rem;color:rgba(255,255,255,0.4);padding:12px 24px;border-top:1px solid rgba(255,255,255,0.1);line-height:1.5;}
        .main-content{flex:1;margin-left:260px;}.header{background:white;padding:20px 32px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;}
        .header h2{font-size:1.5rem;font-weight:700;}.user-info{display:flex;align-items:center;gap:16px;}.user-email{color:var(--text-muted);font-size:0.875rem;}
        .content{padding:32px;}.panel{display:none;}.panel.active{display:block;}
        .panel-card{background:white;border-radius:12px;box-shadow:var(--shadow);margin-bottom:24px;}
        .panel-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;}
        .panel-header h3{font-size:1.125rem;font-weight:600;}.panel-body{padding:24px;}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:24px;}
        .stat-card{background:white;padding:24px;border-radius:12px;box-shadow:var(--shadow);}.stat-card h3{font-size:0.875rem;color:var(--text-muted);margin-bottom:8px;}
        .stat-value{font-size:2rem;font-weight:700;color:var(--primary);}
        .table-container{overflow-x:auto;}table{width:100%;border-collapse:collapse;}
        th,td{padding:12px 16px;text-align:left;border-bottom:1px solid var(--border);}th{background:var(--bg);font-weight:600;font-size:0.875rem;color:var(--text-muted);}
        td{font-size:0.875rem;}tr:hover td{background:#f8fafc;}
        .pricing-textarea{width:100%;min-height:300px;font-family:'Monaco','Consolas',monospace;font-size:0.9rem;line-height:1.6;padding:16px;border:2px solid var(--border);border-radius:var(--radius);}
        .pricing-help{background:#eff6ff;padding:16px;border-radius:var(--radius);margin-bottom:16px;font-size:0.875rem;color:#0369a1;line-height:1.6;}
        .pricing-help code{background:rgba(0,0,0,0.1);padding:2px 6px;border-radius:4px;}
        .content-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;}
        .content-card{background:white;border-radius:12px;box-shadow:var(--shadow);overflow:hidden;transition:transform 0.2s,box-shadow 0.2s;}
        .content-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);}
        .content-card-header{height:70px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));display:flex;align-items:center;justify-content:space-between;padding:0 16px;}
        .content-card-header .card-badge{background:rgba(255,255,255,0.2);color:white;font-size:0.7rem;padding:2px 8px;border-radius:99px;}
        .content-card-body{padding:16px;}.content-card-title{font-weight:600;margin-bottom:4px;}
        .content-card-meta{font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;}
        .content-card-desc{font-size:0.85rem;color:var(--text-muted);margin-bottom:12px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
        .content-card-actions{display:flex;gap:8px;}
        .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;}
        .gallery-item{position:relative;border-radius:var(--radius);overflow:hidden;aspect-ratio:1;background:var(--bg);cursor:pointer;}
        .gallery-item img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s;}.gallery-item:hover img{transform:scale(1.05);}
        .gallery-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.85)0%,transparent 60%);opacity:0;transition:opacity 0.2s;display:flex;flex-direction:column;justify-content:flex-end;padding:12px;}
        .gallery-item:hover .gallery-overlay{opacity:1;}
        .upload-zone{border:2px dashed var(--border);border-radius:12px;padding:32px 20px;text-align:center;cursor:pointer;transition:all 0.2s;background:white;margin-bottom:20px;}
        .upload-zone:hover,.upload-zone.dragover{border-color:var(--primary);background:#f0f7ff;}
        .upload-progress{margin-bottom:16px;}.progress-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden;}
        .progress-fill{height:100%;background:var(--primary);transition:width 0.3s;border-radius:3px;}
        .review-card{background:white;border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;transition:box-shadow 0.2s;}
        .review-card:hover{box-shadow:var(--shadow);}.review-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px;}
        .review-author{font-weight:600;}.review-rating{color:var(--accent);font-size:1.1rem;}
        .review-text{color:var(--text-muted);font-size:0.9rem;line-height:1.6;font-style:italic;}.review-meta{margin-top:12px;font-size:0.8rem;color:var(--text-muted);}
        .wu-item{background:var(--bg);padding:20px;border-radius:var(--radius);margin-bottom:16px;border:2px solid transparent;transition:border-color 0.2s;position:relative;}
        .wu-item:hover{border-color:var(--border);}.wu-item-number{position:absolute;top:-10px;left:16px;background:var(--primary);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;}
        .wu-remove{position:absolute;top:8px;right:8px;}
        .modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;align-items:center;justify-content:center;padding:20px;}
        .modal.active{display:flex;}.modal-content{background:white;border-radius:16px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;}
        .modal-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
        .modal-header h3{font-size:1.25rem;font-weight:600;}.modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-muted);padding:4px;}
        .modal-body{padding:24px;}.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:12px;}
        .toast{position:fixed;bottom:24px;right:24px;padding:16px 24px;background:var(--primary);color:white;border-radius:var(--radius);box-shadow:var(--shadow-lg);transform:translateY(100px);opacity:0;transition:all 0.3s;z-index:2000;max-width:400px;}
        .toast.active{transform:translateY(0);opacity:1;}.toast.success{background:var(--success);}.toast.error{background:var(--error);}
        .loading{display:flex;align-items:center;gap:12px;color:var(--text-muted);padding:20px;}
        .spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;}@keyframes spin{to{transform:rotate(360deg);}}
        .tabs{display:flex;gap:4px;border-bottom:2px solid var(--border);margin-bottom:24px;overflow-x:auto;}
        .tab{padding:12px 24px;cursor:pointer;font-weight:500;color:var(--text-muted);border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s;white-space:nowrap;}
        .tab:hover{color:var(--text);}.tab.active{color:var(--primary);border-bottom-color:var(--primary);}
        .info-banner{background:linear-gradient(135deg,#eff6ff,#dbeafe);border:1px solid #bfdbfe;border-radius:var(--radius);padding:16px 20px;margin-bottom:24px;display:flex;align-items:flex-start;gap:12px;}
        .info-banner svg{flex-shrink:0;color:#2563eb;}.info-banner-content h4{font-size:0.9rem;font-weight:600;color:#1e40af;margin-bottom:4px;}
        .info-banner-content p{font-size:0.8rem;color:#3b82f6;line-height:1.5;}
        .confirm-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:3000;display:flex;align-items:center;justify-content:center;padding:20px;}
        .confirm-box{background:white;border-radius:12px;padding:32px;max-width:400px;text-align:center;}
        .confirm-box h4{margin-bottom:12px;}.confirm-box p{color:var(--text-muted);margin-bottom:24px;font-size:0.9rem;}
        .confirm-actions{display:flex;gap:12px;justify-content:center;}
        .empty-state{text-align:center;padding:48px 20px;color:var(--text-muted);}.empty-state h4{font-size:1.1rem;color:var(--text);margin-bottom:8px;}.empty-state p{font-size:0.9rem;margin-bottom:20px;}
        @media(max-width:768px){.sidebar{transform:translateX(-100%);transition:transform 0.3s;}.sidebar.open{transform:translateX(0);}.main-content{margin-left:0;}.dashboard.active{flex-direction:column;}.header{padding:16px;}.content{padding:16px;}.mobile-toggle{display:block!important;}}
        .mobile-toggle{display:none;background:none;border:none;cursor:pointer;padding:8px;}
    </style>
</head>
<body>
    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <div class="login-logo">Ghareeb <span>Fencing</span></div>
            <p class="login-subtitle">Content Management</p>
            <div class="login-error" id="login-error"></div>
            <form class="login-form" id="login-form">
                <div class="form-group"><label for="email">Email</label><input type="email" id="email" required placeholder="admin@example.com"></div>
                <div class="form-group"><label for="password">Password</label><input type="password" id="password" required placeholder="••••••••"></div>
                <button type="submit" class="btn btn-primary btn-block">Sign In</button>
            </form>
        </div>
    </div>
    <div class="dashboard" id="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo"><h1>Ghareeb <span>Fencing</span></h1><p>Content Management</p></div>
            <nav>
                <div class="nav-section"><div class="nav-section-title">Overview</div>
                    <a class="nav-link active" data-panel="overview"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>Dashboard</a>
                </div>
                <div class="nav-section"><div class="nav-section-title">Website Content</div>
                    <a class="nav-link" data-panel="fences"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>Fence Types</a>
                    <a class="nav-link" data-panel="reviews"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>Reviews</a>
                    <a class="nav-link" data-panel="gallery"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>Gallery</a>
                    <a class="nav-link" data-panel="why-us"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>Why Choose Us</a>
                </div>
                <div class="nav-section"><div class="nav-section-title">Settings</div>
                    <a class="nav-link" data-panel="pricing"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>Pricing</a>
                    <a class="nav-link" data-panel="site-settings"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>Site Settings</a>
                </div>
            </nav>
            <div class="nav-note"><strong>Note:</strong> Leads, jobs & scheduling are managed in the Executive App.</div>
        </aside>
        <main class="main-content">
            <header class="header">
                <div style="display:flex;align-items:center;gap:12px;">
                    <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
                    <h2 id="panel-title">Dashboard</h2>
                </div>
                <div class="user-info"><span class="user-email" id="user-email"></span><button class="btn btn-logout" id="logout-btn">Sign Out</button></div>
            </header>
            <div class="content">
                <div class="panel active" id="panel-overview">
                    <div class="info-banner"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><div class="info-banner-content"><h4>Website Content Management</h4><p>Manage your website content here. For leads, jobs, scheduling, and business operations, use the <strong>Executive App</strong>.</p></div></div>
                    <div class="stats-grid">
                        <div class="stat-card"><h3>Fence Types</h3><div class="stat-value" id="stat-fences">—</div></div>
                        <div class="stat-card"><h3>Reviews</h3><div class="stat-value" id="stat-reviews">—</div></div>
                        <div class="stat-card"><h3>Gallery Images</h3><div class="stat-value" id="stat-gallery">—</div></div>
                        <div class="stat-card"><h3>Pricing Items</h3><div class="stat-value" id="stat-pricing">—</div></div>
                    </div>
                    <div class="panel-card"><div class="panel-header"><h3>Quick Actions</h3></div><div class="panel-body"><div style="display:flex;gap:12px;flex-wrap:wrap;"><a class="btn btn-primary quick-nav" data-panel="fences">Manage Fence Types</a><a class="btn btn-outline quick-nav" data-panel="reviews">Manage Reviews</a><a class="btn btn-outline quick-nav" data-panel="gallery">Upload Photos</a><a class="btn btn-outline quick-nav" data-panel="pricing">Edit Pricing</a></div></div></div>
                    <div class="panel-card"><div class="panel-header"><h3>Content Status</h3></div><div class="panel-body" id="content-status"><div class="loading"><div class="spinner"></div> Loading...</div></div></div>
                </div>
                <div class="panel" id="panel-fences"><div class="panel-card"><div class="panel-header"><h3>Fence Types</h3><button class="btn btn-sm btn-primary" id="add-fence-btn">+ Add Fence Type</button></div><div class="panel-body"><div class="pricing-help"><strong>Tip:</strong> Fence types appear on your website. Slugs auto-generate from the name.</div><div class="content-grid" id="fences-grid"><div class="loading"><div class="spinner"></div> Loading...</div></div></div></div></div>
                <div class="panel" id="panel-reviews"><div class="panel-card"><div class="panel-header"><h3>Customer Reviews</h3><div style="display:flex;gap:8px;"><span style="color:var(--text-muted);font-size:0.875rem;align-self:center;" id="reviews-count"></span><button class="btn btn-sm btn-primary" id="add-review-btn">+ Add Review</button></div></div><div class="panel-body" id="reviews-container"><div class="loading"><div class="spinner"></div> Loading...</div></div></div></div>
                <div class="panel" id="panel-gallery"><div class="panel-card"><div class="panel-header"><h3>Photo Gallery</h3><div style="display:flex;gap:8px;align-items:center;"><span style="color:var(--text-muted);font-size:0.875rem;" id="gallery-count"></span><button class="btn btn-sm btn-outline" id="refresh-gallery">↻ Refresh</button></div></div><div class="panel-body">
                    <div class="upload-zone" id="upload-zone"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="48" height="48"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg><p><strong>Drop images here</strong> or click to browse</p><small>JPG, PNG, WebP • Max 5MB per image</small><input type="file" id="gallery-upload" accept="image/jpeg,image/png,image/webp" multiple style="display:none;"></div>
                    <div class="upload-progress" id="upload-progress" style="display:none;"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><small id="upload-status">Uploading...</small><small id="upload-percent">0%</small></div><div class="progress-bar"><div class="progress-fill" id="upload-fill" style="width:0%"></div></div></div>
                    <div class="gallery-grid" id="gallery-grid"></div>
                </div></div></div>
                <div class="panel" id="panel-why-us"><div class="panel-card"><div class="panel-header"><h3>Why Choose Us</h3><div style="display:flex;gap:8px;"><button class="btn btn-sm btn-outline" id="add-wu-btn">+ Add Item</button><button class="btn btn-sm btn-success" id="save-why-us">Save Changes</button></div></div><div class="panel-body"><div class="pricing-help"><strong>Tip:</strong> These selling points display on the homepage. Recommended: 4 items.</div><div id="why-us-editor"><div class="loading"><div class="spinner"></div> Loading...</div></div></div></div></div>
                <div class="panel" id="panel-pricing"><div class="panel-card"><div class="panel-header"><h3>Pricing Configuration</h3><button class="btn btn-sm btn-success" id="save-pricing">Save Pricing</button></div><div class="panel-body">
                    <div class="pricing-help"><strong>Format:</strong> <code>Style Name : price/ft : single gate : double gate</code><br><strong>Example:</strong> <code>Cedar Privacy : 42 : 375 : 695</code><br><br><strong>⚡ Sync:</strong> This pricing syncs with the Ballpark Calculator and Executive App automatically.</div>
                    <textarea class="pricing-textarea" id="pricing-editor" placeholder="Loading..."></textarea><div id="pricing-preview" style="margin-top:16px;"></div>
                </div></div></div>
                <div class="panel" id="panel-site-settings"><div class="panel-card"><div class="panel-header"><h3>Site Settings</h3><button class="btn btn-sm btn-success" id="save-site-settings">Save All Settings</button></div><div class="panel-body">
                    <div class="tabs"><div class="tab active" data-tab="hero">Hero Section</div><div class="tab" data-tab="stats">Stats</div><div class="tab" data-tab="contact">Contact</div><div class="tab" data-tab="seo">SEO</div></div>
                    <div class="tab-content" id="tab-hero"><div class="form-group"><label>Badge Text</label><input type="text" id="hero-badge" placeholder="Toledo's #1 Rated Fence Contractor"><div class="help-text">Appears above the main hero title</div></div><div class="form-group"><label>Hero Title</label><input type="text" id="hero-title" placeholder="Your Family Deserves a"></div><div class="form-group"><label>Title Highlight</label><input type="text" id="hero-highlight" placeholder="Beautiful, Safe Backyard"><div class="help-text">Gold-colored emphasized text</div></div><div class="form-group"><label>Subtitle</label><textarea id="hero-subtitle" rows="2" placeholder="Professional fence installation..."></textarea></div></div>
                    <div class="tab-content" id="tab-stats" style="display:none;"><div class="form-row"><div class="form-group"><label>Fences Installed</label><input type="text" id="stat-fences-installed" placeholder="500+"></div><div class="form-group"><label>Google Rating</label><input type="text" id="stat-rating" placeholder="4.9"></div></div><div class="form-row"><div class="form-group"><label>Review Count</label><input type="text" id="stat-review-count" placeholder="127"></div><div class="form-group"><label>Warranty</label><input type="text" id="stat-warranty" placeholder="3 Year"></div></div></div>
                    <div class="tab-content" id="tab-contact" style="display:none;"><div class="form-row"><div class="form-group"><label>Phone</label><input type="text" id="contact-phone" placeholder="(419) 902-8257"></div><div class="form-group"><label>Email</label><input type="email" id="contact-email" placeholder="info@ghareebfencingsolutions.com"></div></div><div class="form-row"><div class="form-group"><label>City</label><input type="text" id="contact-city" placeholder="Toledo"></div><div class="form-group"><label>State</label><input type="text" id="contact-state" placeholder="OH"></div></div></div>
                    <div class="tab-content" id="tab-seo" style="display:none;"><div class="form-group"><label>Default Page Title</label><input type="text" id="seo-title" placeholder="Fence Installation Toledo OH | Ghareeb Fencing Solutions"><div class="help-text">Shown in browser tabs and Google results</div></div><div class="form-group"><label>Meta Description</label><textarea id="seo-description" rows="3" placeholder="Toledo's top-rated fence contractor..."></textarea><div style="font-size:0.75rem;color:var(--text-muted);text-align:right;margin-top:2px;"><span id="seo-desc-count">0</span>/160 characters</div></div><div class="form-group"><label>Keywords</label><input type="text" id="seo-keywords" placeholder="fence installation, toledo fence contractor..."></div></div>
                </div></div></div>
            </div>
        </main>
    </div>

    <!-- Fence Modal -->
    <div class="modal" id="fence-modal"><div class="modal-content">
        <div class="modal-header"><h3 id="fence-modal-title">Edit Fence</h3><button class="modal-close" id="fence-modal-close">&times;</button></div>
        <div class="modal-body">
            <input type="hidden" id="fence-id">
            <div class="form-group"><label>Name *</label><input type="text" id="fence-name" placeholder="Cedar Privacy" required></div>
            <div class="form-group"><label>URL Slug</label><input type="text" id="fence-slug" placeholder="auto-generated"><div class="help-text">Auto-generated from name. URL: /fences/<strong id="slug-preview">...</strong>/</div></div>
            <div class="form-group"><label>Short Description</label><textarea id="fence-description" rows="2" placeholder="Brief description for cards"></textarea></div>
            <div class="form-group"><label>Full Description</label><textarea id="fence-full-description" rows="5" placeholder="Detailed description for the fence page"></textarea></div>
            <div class="form-row"><div class="form-group"><label>Price Range</label><input type="text" id="fence-price" placeholder="$35-50/ft"></div><div class="form-group"><label>Lifespan</label><input type="text" id="fence-lifespan" placeholder="20-25 years"></div></div>
            <div class="form-group"><label>Features (one per line)</label><textarea id="fence-features" rows="5" placeholder="Complete privacy&#10;Natural wood beauty&#10;Various height options"></textarea><div class="help-text">Each line becomes a bullet point</div></div>
        </div>
        <div class="modal-footer"><button class="btn btn-outline" id="fence-cancel">Cancel</button><button class="btn btn-primary" id="fence-save">Save Fence Type</button></div>
    </div></div>

    <!-- Review Modal -->
    <div class="modal" id="review-modal"><div class="modal-content">
        <div class="modal-header"><h3 id="review-modal-title">Add Review</h3><button class="modal-close" id="review-modal-close">&times;</button></div>
        <div class="modal-body">
            <input type="hidden" id="review-id">
            <div class="form-row"><div class="form-group"><label>Customer Name *</label><input type="text" id="review-name" placeholder="John Smith" required></div><div class="form-group"><label>Rating</label><select id="review-rating"><option value="5">★★★★★ (5)</option><option value="4">★★★★☆ (4)</option><option value="3">★★★☆☆ (3)</option><option value="2">★★☆☆☆ (2)</option><option value="1">★☆☆☆☆ (1)</option></select></div></div>
            <div class="form-row"><div class="form-group"><label>Location</label><input type="text" id="review-location" placeholder="Toledo, OH"></div><div class="form-group"><label>Project Type</label><input type="text" id="review-project" placeholder="Cedar Privacy Fence"></div></div>
            <div class="form-group"><label>Review Text *</label><textarea id="review-text" rows="4" placeholder="Customer's review text..." required></textarea></div>
        </div>
        <div class="modal-footer"><button class="btn btn-outline" id="review-cancel">Cancel</button><button class="btn btn-primary" id="review-save">Save Review</button></div>
    </div></div>

    <!-- Image Preview Modal -->
    <div class="modal" id="image-modal"><div class="modal-content" style="max-width:800px;">
        <div class="modal-header"><h3 id="image-modal-title">Image</h3><button class="modal-close" id="image-modal-close">&times;</button></div>
        <div class="modal-body" style="padding:0;text-align:center;"><img id="image-preview" style="max-width:100%;max-height:70vh;object-fit:contain;" alt="Preview"></div>
        <div class="modal-footer"><button class="btn btn-danger btn-sm" id="image-delete">Delete Image</button><button class="btn btn-outline btn-sm" id="image-close-btn">Close</button></div>
    </div></div>

    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>

    <script is:inline define:vars={{ firebaseConfig, defaultFences: fences.fenceTypes, defaultReviews: reviews }}>
    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth(), db=firebase.firestore(), storage=firebase.storage();
    const toast=document.getElementById('toast');
    // Sanitize strings before innerHTML insertion (strips dangerous tags)
    function san(s){return s?String(s).replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'):'';}
    function showToast(m,t='info'){toast.textContent=m;toast.className='toast active '+t;setTimeout(()=>toast.classList.remove('active'),3000);}
    function confirmAction(title,msg){return new Promise(r=>{const o=document.createElement('div');o.className='confirm-overlay';o.innerHTML='<div class="confirm-box"><h4>'+san(title)+'</h4><p>'+san(msg)+'</p><div class="confirm-actions"><button class="btn btn-sm btn-outline" id="cn">Cancel</button><button class="btn btn-sm btn-danger" id="cy">Confirm</button></div></div>';document.body.appendChild(o);o.querySelector('#cy').onclick=()=>{document.body.removeChild(o);r(true);};o.querySelector('#cn').onclick=()=>{document.body.removeChild(o);r(false);}});}
    function slugify(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,'').replace(/[\s_]+/g,'-').replace(/-+/g,'-').replace(/^-+|-+$/g,'');}
    const titles={overview:'Dashboard',fences:'Fence Types',reviews:'Reviews',gallery:'Gallery','why-us':'Why Choose Us',pricing:'Pricing','site-settings':'Site Settings'};
    document.querySelectorAll('.nav-link,.quick-nav').forEach(l=>l.addEventListener('click',()=>{const p=l.dataset.panel;document.querySelectorAll('.nav-link').forEach(x=>x.classList.remove('active'));document.querySelector('.nav-link[data-panel="'+p+'"]')?.classList.add('active');document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));document.getElementById('panel-'+p).classList.add('active');document.getElementById('panel-title').textContent=titles[p]||'Dashboard';document.getElementById('sidebar').classList.remove('open');const L={fences:loadFences,reviews:loadReviews,gallery:loadGallery,'why-us':loadWhyUs,pricing:loadPricing,'site-settings':loadSiteSettings};if(L[p])L[p]();}));
    document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));t.classList.add('active');document.querySelectorAll('.tab-content').forEach(x=>x.style.display='none');document.getElementById('tab-'+t.dataset.tab).style.display='block';}));
    const seoDesc=document.getElementById('seo-description');if(seoDesc)seoDesc.addEventListener('input',()=>{const c=seoDesc.value.length;const e=document.getElementById('seo-desc-count');e.textContent=c;e.style.color=c>160?'var(--error)':'var(--text-muted)';});
    auth.onAuthStateChanged(u=>{if(u){document.getElementById('login-screen').classList.add('hidden');document.getElementById('dashboard').classList.add('active');document.getElementById('user-email').textContent=u.email;loadDashboard();}else{document.getElementById('login-screen').classList.remove('hidden');document.getElementById('dashboard').classList.remove('active');}});
    document.getElementById('login-form').addEventListener('submit',async e=>{e.preventDefault();const err=document.getElementById('login-error');err.style.display='none';try{await auth.signInWithEmailAndPassword(document.getElementById('email').value,document.getElementById('password').value);}catch(er){err.textContent=er.code==='auth/invalid-credential'?'Invalid email or password.':er.message;err.style.display='block';}});
    document.getElementById('logout-btn').addEventListener('click',()=>auth.signOut());

    async function loadDashboard(){try{const[fd,rd,gs,pd]=await Promise.all([db.collection('content').doc('fences').get(),db.collection('content').doc('reviews').get(),db.collection('gallery').get(),db.collection('settings').doc('global').get()]);document.getElementById('stat-fences').textContent=fd.exists&&fd.data().items?fd.data().items.length:defaultFences.length;document.getElementById('stat-reviews').textContent=rd.exists&&rd.data().items?rd.data().items.length:(defaultReviews.reviews||[]).length;document.getElementById('stat-gallery').textContent=gs.size;document.getElementById('stat-pricing').textContent=pd.exists&&pd.data().pricing?pd.data().pricing.trim().split('\n').filter(l=>l.trim()).length:5;loadContentStatus(fd,rd,gs,pd);}catch(e){console.error(e);}}

    function loadContentStatus(fd,rd,gs,pd){const c=document.getElementById('content-status');const items=[{n:'Fence Types',s:fd.exists&&fd.data().items?.length>0?'ok':'def',c:fd.exists&&fd.data().items?fd.data().items.length:defaultFences.length},{n:'Reviews',s:rd.exists&&rd.data().items?.length>0?'ok':'def',c:rd.exists&&rd.data().items?rd.data().items.length:(defaultReviews.reviews||[]).length},{n:'Gallery',s:gs.size>0?'ok':'empty',c:gs.size},{n:'Pricing',s:pd.exists&&pd.data().pricing?'ok':'def',c:pd.exists&&pd.data().pricing?pd.data().pricing.trim().split('\n').filter(l=>l.trim()).length:5}];c.innerHTML='<table><thead><tr><th>Content</th><th>Status</th><th>Items</th></tr></thead><tbody>'+items.map(i=>'<tr><td><strong>'+i.n+'</strong></td><td><span style="color:'+(i.s==='ok'?'var(--success)':i.s==='empty'?'var(--warning)':'var(--text-muted)')+'">'+(i.s==='ok'?'✓ Configured':i.s==='empty'?'⚠ Empty':'◦ Using defaults')+'</span></td><td>'+i.c+'</td></tr>').join('')+'</tbody></table>';}

    // FENCE TYPES
    async function loadFences(){const g=document.getElementById('fences-grid');g.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{const s=await db.collection('content').doc('fences').get();window.fencesData=s.exists&&s.data().items?s.data().items:[...defaultFences];renderFences();}catch(e){g.innerHTML='<p style="color:var(--error)">Error loading.</p>';}}
    function renderFences(){const g=document.getElementById('fences-grid');if(!window.fencesData.length){g.innerHTML='<div class="empty-state"><h4>No fence types</h4><p>Add your first fence type.</p></div>';return;}g.innerHTML=window.fencesData.map((f,i)=>'<div class="content-card"><div class="content-card-header"><svg fill="none" stroke="rgba(255,255,255,0.3)" viewBox="0 0 24 24" width="32" height="32"><rect x="3" y="3" width="18" height="18" rx="2" stroke-width="1.5"/></svg><span class="card-badge">'+(f.priceRange||'No price')+'</span></div><div class="content-card-body"><div class="content-card-title">'+f.name+'</div><div class="content-card-meta">/fences/'+(f.slug||'—')+'/ • '+(f.lifespan||'—')+'</div><div class="content-card-desc">'+(f.shortDescription||f.description?.substring(0,100)||'No description')+'</div><div class="content-card-actions"><button class="btn btn-sm btn-outline" onclick="editFence('+i+')">✎ Edit</button><button class="btn btn-sm btn-danger" onclick="delFence('+i+')">✕ Delete</button></div></div></div>').join('');}
    document.getElementById('fence-name').addEventListener('input',function(){const s=document.getElementById('fence-slug'),i=document.getElementById('fence-id').value;if(i===''||!s.value)s.value=slugify(this.value);document.getElementById('slug-preview').textContent=s.value||'...';});
    document.getElementById('fence-slug').addEventListener('input',function(){this.value=slugify(this.value);document.getElementById('slug-preview').textContent=this.value||'...';});
    const fm=document.getElementById('fence-modal');
    document.getElementById('add-fence-btn').addEventListener('click',()=>{document.getElementById('fence-modal-title').textContent='Add New Fence Type';document.getElementById('fence-id').value='';['fence-name','fence-slug','fence-description','fence-full-description','fence-price','fence-lifespan','fence-features'].forEach(x=>document.getElementById(x).value='');document.getElementById('slug-preview').textContent='...';fm.classList.add('active');});
    window.editFence=i=>{const f=window.fencesData[i];document.getElementById('fence-modal-title').textContent='Edit: '+(f.name||'Fence');document.getElementById('fence-id').value=i;document.getElementById('fence-name').value=f.name||'';document.getElementById('fence-slug').value=f.slug||'';document.getElementById('fence-description').value=f.shortDescription||'';document.getElementById('fence-full-description').value=f.description||'';document.getElementById('fence-price').value=f.priceRange||'';document.getElementById('fence-lifespan').value=f.lifespan||'';document.getElementById('fence-features').value=(f.features||[]).join('\n');document.getElementById('slug-preview').textContent=f.slug||'...';fm.classList.add('active');};
    window.delFence=async i=>{if(!await confirmAction('Delete Fence','Delete "'+window.fencesData[i]?.name+'"? This cannot be undone.'))return;window.fencesData.splice(i,1);await db.collection('content').doc('fences').set({items:window.fencesData});showToast('Deleted','success');renderFences();};
    document.getElementById('fence-modal-close').addEventListener('click',()=>fm.classList.remove('active'));
    document.getElementById('fence-cancel').addEventListener('click',()=>fm.classList.remove('active'));
    document.getElementById('fence-save').addEventListener('click',async()=>{const n=document.getElementById('fence-name').value.trim();if(!n){showToast('Name is required','error');return;}const idx=document.getElementById('fence-id').value;const d={name:n,slug:document.getElementById('fence-slug').value||slugify(n),shortDescription:document.getElementById('fence-description').value,description:document.getElementById('fence-full-description').value,priceRange:document.getElementById('fence-price').value,lifespan:document.getElementById('fence-lifespan').value,features:document.getElementById('fence-features').value.split('\n').filter(x=>x.trim())};if(idx==='')window.fencesData.push(d);else window.fencesData[parseInt(idx)]={...window.fencesData[parseInt(idx)],...d};try{await db.collection('content').doc('fences').set({items:window.fencesData});showToast('Saved!','success');fm.classList.remove('active');renderFences();}catch(e){showToast('Error: '+e.message,'error');}});

    // REVIEWS
    async function loadReviews(){const c=document.getElementById('reviews-container');c.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{const s=await db.collection('content').doc('reviews').get();window.reviewsData=s.exists&&s.data().items?s.data().items:[...(defaultReviews.reviews||[])];renderReviews();}catch(e){c.innerHTML='<p style="color:var(--error)">Error loading.</p>';}}
    function renderReviews(){const c=document.getElementById('reviews-container');document.getElementById('reviews-count').textContent=window.reviewsData.length+' reviews';if(!window.reviewsData.length){c.innerHTML='<div class="empty-state"><h4>No reviews</h4><p>Add customer reviews to build trust.</p></div>';return;}c.innerHTML=window.reviewsData.map((r,i)=>'<div class="review-card"><div class="review-header"><div><div class="review-author">'+(r.name||'Anonymous')+'</div><div class="review-meta">'+[r.location,r.project].filter(Boolean).join(' • ')+'</div></div><div style="display:flex;gap:8px;align-items:center;"><span class="review-rating">'+'★'.repeat(r.rating||5)+'☆'.repeat(5-(r.rating||5))+'</span><button class="btn btn-xs btn-outline" onclick="editReview('+i+')">Edit</button><button class="btn btn-xs btn-danger" onclick="delReview('+i+')">Del</button></div></div><div class="review-text">"'+(r.text||'')+'"</div></div>').join('');}
    const rm=document.getElementById('review-modal');
    document.getElementById('add-review-btn').addEventListener('click',()=>{document.getElementById('review-modal-title').textContent='Add New Review';document.getElementById('review-id').value='';['review-name','review-location','review-project','review-text'].forEach(x=>document.getElementById(x).value='');document.getElementById('review-rating').value='5';rm.classList.add('active');});
    window.editReview=i=>{const r=window.reviewsData[i];document.getElementById('review-modal-title').textContent='Edit Review';document.getElementById('review-id').value=i;document.getElementById('review-name').value=r.name||'';document.getElementById('review-rating').value=r.rating||5;document.getElementById('review-location').value=r.location||'';document.getElementById('review-project').value=r.project||'';document.getElementById('review-text').value=r.text||'';rm.classList.add('active');};
    window.delReview=async i=>{if(!await confirmAction('Delete Review','Delete review from "'+window.reviewsData[i]?.name+'"?'))return;window.reviewsData.splice(i,1);await db.collection('content').doc('reviews').set({items:window.reviewsData});showToast('Deleted','success');renderReviews();};
    document.getElementById('review-modal-close').addEventListener('click',()=>rm.classList.remove('active'));
    document.getElementById('review-cancel').addEventListener('click',()=>rm.classList.remove('active'));
    document.getElementById('review-save').addEventListener('click',async()=>{const n=document.getElementById('review-name').value.trim(),t=document.getElementById('review-text').value.trim();if(!n||!t){showToast('Name and text required','error');return;}const idx=document.getElementById('review-id').value;const d={name:n,rating:parseInt(document.getElementById('review-rating').value),location:document.getElementById('review-location').value,project:document.getElementById('review-project').value,text:t};if(idx==='')window.reviewsData.push(d);else window.reviewsData[parseInt(idx)]=d;try{await db.collection('content').doc('reviews').set({items:window.reviewsData});showToast('Saved!','success');rm.classList.remove('active');renderReviews();}catch(e){showToast('Error: '+e.message,'error');}});

    // GALLERY
    async function loadGallery(){const g=document.getElementById('gallery-grid');g.innerHTML='<div class="loading"><div class="spinner"></div> Loading...</div>';try{const s=await db.collection('gallery').orderBy('uploadedAt','desc').get();document.getElementById('gallery-count').textContent=s.size+' images';if(s.empty){g.innerHTML='<div class="empty-state" style="grid-column:1/-1;"><h4>No images</h4><p>Upload photos to showcase your work.</p></div>';return;}g.innerHTML=s.docs.map(d=>{const x=d.data();return '<div class="gallery-item" onclick="previewImage(\''+d.id+'\',\''+encodeURIComponent(x.url)+'\',\''+encodeURIComponent(x.name||'Untitled')+'\',\''+encodeURIComponent(x.storagePath||'')+'\')"><img src="'+x.url+'" alt="'+(x.name||'Gallery')+'" loading="lazy"><div class="gallery-overlay"><span style="color:white;font-size:0.8rem;margin-bottom:8px;">'+(x.name||'Untitled')+'</span><button class="btn btn-xs btn-danger" onclick="event.stopPropagation();delImg(\''+d.id+'\',\''+encodeURIComponent(x.storagePath||'')+'\')">Delete</button></div></div>';}).join('');}catch(e){g.innerHTML='<p style="color:var(--error)">Error loading gallery.</p>';}}
    const imgModal=document.getElementById('image-modal');let curImg={};
    window.previewImage=(id,uEnc,nEnc,pEnc)=>{curImg={id,path:decodeURIComponent(pEnc)};document.getElementById('image-preview').src=decodeURIComponent(uEnc);document.getElementById('image-modal-title').textContent=decodeURIComponent(nEnc);imgModal.classList.add('active');};
    document.getElementById('image-modal-close').addEventListener('click',()=>imgModal.classList.remove('active'));
    document.getElementById('image-close-btn').addEventListener('click',()=>imgModal.classList.remove('active'));
    document.getElementById('image-delete').addEventListener('click',async()=>{if(!await confirmAction('Delete Image','Delete this image permanently?'))return;await delGImg(curImg.id,curImg.path);imgModal.classList.remove('active');});
    const uploadZone=document.getElementById('upload-zone'),fileInput=document.getElementById('gallery-upload');
    uploadZone.addEventListener('click',()=>fileInput.click());
    uploadZone.addEventListener('dragover',e=>{e.preventDefault();uploadZone.classList.add('dragover');});
    uploadZone.addEventListener('dragleave',()=>uploadZone.classList.remove('dragover'));
    uploadZone.addEventListener('drop',e=>{e.preventDefault();uploadZone.classList.remove('dragover');handleFiles(e.dataTransfer.files);});
    fileInput.addEventListener('change',e=>handleFiles(e.target.files));
    async function handleFiles(files){if(!files.length)return;const valid=[...files].filter(f=>{if(f.size>5*1024*1024){showToast(f.name+' too large','error');return false;}if(!f.type.match(/^image\/(jpeg|png|webp)$/)){showToast(f.name+' not supported','error');return false;}return true;});if(!valid.length)return;const prog=document.getElementById('upload-progress'),stat=document.getElementById('upload-status'),pct=document.getElementById('upload-percent'),fill=document.getElementById('upload-fill');prog.style.display='block';for(let i=0;i<valid.length;i++){const f=valid[i];stat.textContent='Uploading '+(i+1)+' of '+valid.length+': '+f.name;fill.style.width=Math.round(i/valid.length*100)+'%';pct.textContent=Math.round(i/valid.length*100)+'%';try{const p='gallery/'+Date.now()+'_'+f.name.replace(/[^a-zA-Z0-9.-]/g,'_');const ref=storage.ref(p);await ref.put(f);const url=await ref.getDownloadURL();await db.collection('gallery').add({name:f.name,url,storagePath:p,uploadedAt:firebase.firestore.FieldValue.serverTimestamp()});}catch(e){showToast('Failed: '+f.name,'error');}}fill.style.width='100%';pct.textContent='100%';stat.textContent='Complete!';setTimeout(()=>{prog.style.display='none';},2000);showToast(valid.length+' image(s) uploaded!','success');loadGallery();fileInput.value='';}
    window.delImg=async(id,pEnc)=>{if(!await confirmAction('Delete','Delete this image?'))return;await delGImg(id,decodeURIComponent(pEnc));};
    async function delGImg(id,path){try{if(path)await storage.ref(path).delete();}catch(e){}await db.collection('gallery').doc(id).delete();showToast('Deleted','success');loadGallery();}
    document.getElementById('refresh-gallery').addEventListener('click',loadGallery);

    // WHY CHOOSE US
    let wuItems=[];
    async function loadWhyUs(){const c=document.getElementById('why-us-editor');try{const s=await db.collection('content').doc('whyUs').get();wuItems=s.exists&&s.data().items?[...s.data().items]:[{title:'Owner Supervised',description:'Every project personally overseen.',icon:'user'},{title:'Honest Pricing',description:'No hidden fees.',icon:'dollar'},{title:'3-Year Warranty',description:'Full workmanship warranty.',icon:'shield'},{title:'0% Financing',description:'Affordable payment plans.',icon:'credit-card'}];renderWhyUs();}catch(e){c.innerHTML='<p style="color:var(--error)">Error loading.</p>';}}
    function renderWhyUs(){const c=document.getElementById('why-us-editor');c.innerHTML=wuItems.map((x,i)=>'<div class="wu-item"><div class="wu-item-number">'+(i+1)+'</div>'+(wuItems.length>1?'<button class="btn btn-xs btn-danger wu-remove" onclick="removeWu('+i+')">✕</button>':'')+'<div class="form-row"><div class="form-group"><label>Title</label><input type="text" class="wu-title" data-i="'+i+'" value="'+(x.title||'')+'"></div><div class="form-group"><label>Icon</label><select class="wu-icon" data-i="'+i+'"><option value="user"'+(x.icon==='user'?' selected':'')+'>👤 Owner</option><option value="dollar"'+(x.icon==='dollar'?' selected':'')+'>💲 Price</option><option value="shield"'+(x.icon==='shield'?' selected':'')+'>🛡️ Warranty</option><option value="credit-card"'+(x.icon==='credit-card'?' selected':'')+'>💳 Finance</option><option value="star"'+(x.icon==='star'?' selected':'')+'>⭐ Quality</option><option value="check"'+(x.icon==='check'?' selected':'')+'>✅ Complete</option><option value="clock"'+(x.icon==='clock'?' selected':'')+'>⏰ Speed</option><option value="heart"'+(x.icon==='heart'?' selected':'')+'>❤️ Care</option></select></div></div><div class="form-group"><label>Description</label><textarea class="wu-desc" data-i="'+i+'" rows="2">'+(x.description||'')+'</textarea></div></div>').join('');}
    window.removeWu=async i=>{if(!await confirmAction('Remove','Remove this item?'))return;wuItems.splice(i,1);renderWhyUs();};
    document.getElementById('add-wu-btn').addEventListener('click',()=>{if(wuItems.length>=8){showToast('Max 8 items','error');return;}wuItems.push({title:'',description:'',icon:'star'});renderWhyUs();});
    document.getElementById('save-why-us').addEventListener('click',async()=>{const items=[];for(let i=0;i<wuItems.length;i++){const t=document.querySelector('.wu-title[data-i="'+i+'"]')?.value||'',d=document.querySelector('.wu-desc[data-i="'+i+'"]')?.value||'',ic=document.querySelector('.wu-icon[data-i="'+i+'"]')?.value||'star';if(t.trim())items.push({title:t,description:d,icon:ic});}if(!items.length){showToast('Need at least one item','error');return;}try{await db.collection('content').doc('whyUs').set({items});wuItems=items;showToast('Saved!','success');renderWhyUs();}catch(e){showToast('Error: '+e.message,'error');}});

    // PRICING
    async function loadPricing(){const e=document.getElementById('pricing-editor');try{const d=await db.collection('settings').doc('global').get();e.value=d.exists&&d.data().pricing?d.data().pricing:'Cedar Privacy : 42 : 375 : 695\nTreated Wood : 35 : 325 : 595\nWhite Vinyl : 45 : 425 : 795\nBlack Chain Link : 22 : 275 : 495\nBlack Aluminum : 48 : 450 : 850';updatePricingPreview();}catch(e){}}
    function updatePricingPreview(){const t=document.getElementById('pricing-editor').value,lines=t.trim().split('\n').filter(l=>l.trim()),prev=document.getElementById('pricing-preview');if(!lines.length){prev.innerHTML='';return;}let v=0,inv=0;const rows=lines.map(l=>{const p=l.split(':').map(s=>s.trim());if(p.length>=4){v++;return '<tr><td>'+p[0]+'</td><td>$'+p[1]+'/ft</td><td>$'+p[2]+'</td><td>$'+p[3]+'</td></tr>';}else{inv++;return '<tr style="color:var(--error)"><td colspan="4">⚠ Invalid: "'+l+'"</td></tr>';}});prev.innerHTML='<div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:8px;">Preview: '+v+' valid'+(inv?', <span style="color:var(--error)">'+inv+' invalid</span>':'')+' </div><div class="table-container"><table><thead><tr><th>Style</th><th>Per Foot</th><th>Single Gate</th><th>Double Gate</th></tr></thead><tbody>'+rows.join('')+'</tbody></table></div>';}
    document.getElementById('pricing-editor').addEventListener('input',updatePricingPreview);
    document.getElementById('save-pricing').addEventListener('click',async()=>{try{await db.collection('settings').doc('global').set({pricing:document.getElementById('pricing-editor').value},{merge:true});showToast('Pricing saved!','success');}catch(e){showToast('Error: '+e.message,'error');}});

    // SITE SETTINGS
    async function loadSiteSettings(){try{const d=await db.collection('settings').doc('site').get();const x=d.exists?d.data():{};document.getElementById('hero-badge').value=x.hero?.badge||'';document.getElementById('hero-title').value=x.hero?.title||'';document.getElementById('hero-highlight').value=x.hero?.highlight||'';document.getElementById('hero-subtitle').value=x.hero?.subtitle||'';document.getElementById('stat-fences-installed').value=x.stats?.fencesInstalled||'';document.getElementById('stat-rating').value=x.stats?.rating||'';document.getElementById('stat-review-count').value=x.stats?.reviewCount||'';document.getElementById('stat-warranty').value=x.stats?.warranty||'';document.getElementById('contact-phone').value=x.contact?.phone||'';document.getElementById('contact-email').value=x.contact?.email||'';document.getElementById('contact-city').value=x.contact?.city||'';document.getElementById('contact-state').value=x.contact?.state||'';document.getElementById('seo-title').value=x.seo?.title||'';document.getElementById('seo-description').value=x.seo?.description||'';document.getElementById('seo-keywords').value=x.seo?.keywords||'';seoDesc?.dispatchEvent(new Event('input'));}catch(e){showToast('Error loading settings','error');}}
    document.getElementById('save-site-settings').addEventListener('click',async()=>{try{await db.collection('settings').doc('site').set({hero:{badge:document.getElementById('hero-badge').value,title:document.getElementById('hero-title').value,highlight:document.getElementById('hero-highlight').value,subtitle:document.getElementById('hero-subtitle').value},stats:{fencesInstalled:document.getElementById('stat-fences-installed').value,rating:document.getElementById('stat-rating').value,reviewCount:document.getElementById('stat-review-count').value,warranty:document.getElementById('stat-warranty').value},contact:{phone:document.getElementById('contact-phone').value,email:document.getElementById('contact-email').value,city:document.getElementById('contact-city').value,state:document.getElementById('contact-state').value},seo:{title:document.getElementById('seo-title').value,description:document.getElementById('seo-description').value,keywords:document.getElementById('seo-keywords').value},updatedAt:firebase.firestore.FieldValue.serverTimestamp()});showToast('Settings saved!','success');}catch(e){showToast('Error: '+e.message,'error');}});

    // KEYBOARD SHORTCUTS
    document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='s'){e.preventDefault();const a=document.querySelector('.panel.active');if(!a)return;const id=a.id;if(id==='panel-pricing')document.getElementById('save-pricing').click();else if(id==='panel-site-settings')document.getElementById('save-site-settings').click();else if(id==='panel-why-us')document.getElementById('save-why-us').click();}if(e.key==='Escape')document.querySelectorAll('.modal.active').forEach(m=>m.classList.remove('active'));});
    document.querySelectorAll('.modal').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('active');}));
    </script>
</body>
</html>
