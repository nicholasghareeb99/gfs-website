---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getGallery } from '../../lib/firestore.js';

// SSR: Fetch gallery from Firestore (or static fallback)
const firestoreGallery = await getGallery();

const galleryImages = firestoreGallery.length > 0 ? firestoreGallery : [
    { src: '/images/gallery/wood-privacy-1.jpg', alt: 'Cedar privacy fence installation', category: 'wood' },
    { src: '/images/gallery/wood-privacy-2.jpg', alt: 'Wood fence backyard', category: 'wood' },
    { src: '/images/gallery/vinyl-white-1.jpg', alt: 'White vinyl privacy fence', category: 'vinyl' },
    { src: '/images/gallery/vinyl-tan-1.jpg', alt: 'Tan vinyl fence', category: 'vinyl' },
    { src: '/images/gallery/chainlink-black-1.jpg', alt: 'Black chain link fence', category: 'chainlink' },
    { src: '/images/gallery/chainlink-galv-1.jpg', alt: 'Galvanized chain link fence', category: 'chainlink' },
    { src: '/images/gallery/aluminum-black-1.jpg', alt: 'Black aluminum fence', category: 'aluminum' },
    { src: '/images/gallery/aluminum-pool-1.jpg', alt: 'Aluminum pool fence', category: 'aluminum' },
    { src: '/images/gallery/gate-wood-1.jpg', alt: 'Custom wood gate', category: 'gates' },
    { src: '/images/gallery/gate-iron-1.jpg', alt: 'Decorative iron gate', category: 'gates' },
    { src: '/images/gallery/commercial-1.jpg', alt: 'Commercial fencing project', category: 'commercial' },
    { src: '/images/gallery/farm-split-1.jpg', alt: 'Split rail farm fence', category: 'farm' },
];

// Build categories dynamically from available images
const dynamicCats = [...new Set(galleryImages.map(i => i.category))];
const categories = [
    { id: 'all', name: 'All Projects' },
    ...dynamicCats.map(c => ({ id: c, name: c.charAt(0).toUpperCase() + c.slice(1).replace(/link/i, ' Link') }))
];
---

<BaseLayout 
    title="Fence Gallery | Project Photos | Ghareeb Fencing Solutions"
    description="Browse our gallery of completed fence installations in Toledo and Northwest Ohio. See examples of wood, vinyl, chain link, and aluminum fencing projects."
    canonical="/gallery/"
>
    <!-- Hero -->
    <section class="gallery-hero">
        <div class="container">
            <nav class="breadcrumb">
                <a href="/">Home</a>
                <span>/</span>
                <span>Gallery</span>
            </nav>
            <h1 data-editable data-edit-doc="content/pages" data-edit-field="gallery.title">Our Work</h1>
            <p class="hero-subtitle" data-editable data-edit-doc="content/pages" data-edit-field="gallery.subtitle">Browse completed fence installations across Northwest Ohio</p>
        </div>
    </section>

    <!-- Gallery -->
    <section class="section">
        <div class="container">
            <!-- Filter Buttons -->
            <div class="filter-bar">
                {categories.map(cat => (
                    <button 
                        type="button" 
                        class={`filter-btn ${cat.id === 'all' ? 'active' : ''}`}
                        data-category={cat.id}
                    >
                        {cat.name}
                    </button>
                ))}
            </div>

            <!-- Gallery Grid -->
            <div class="gallery-grid" id="gallery-grid">
                {galleryImages.map(img => (
                    <div class="gallery-item" data-category={img.category}>
                        <img src={img.src} alt={img.alt} loading="lazy" />
                        <div class="gallery-overlay">
                            <span class="gallery-caption">{img.alt}</span>
                            <button type="button" class="zoom-btn" data-src={img.src}>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                            </button>
                        </div>
                    </div>
                ))}
            </div>

            <div class="gallery-note">
                <p>Looking for more? Follow us on social media to see our latest projects!</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a>
                    <a href="#" aria-label="Instagram"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg></a>
                </div>
            </div>
        </div>
    </section>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox">
        <button type="button" class="lightbox-close">&times;</button>
        <img src="" alt="" id="lightbox-img" />
    </div>

    <!-- CTA -->
    <section class="cta-section">
        <div class="container">
            <h2>Ready to Start Your Project?</h2>
            <p>Get a free estimate for your fence installation</p>
            <a href="/quote/ballpark/" class="btn btn-accent btn-lg">Get Free Quote</a>
        </div>
    </section>
</BaseLayout>

<script is:inline>
// Filter functionality
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const category = btn.dataset.category;
        
        // Update active button
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Filter items
        document.querySelectorAll('.gallery-item').forEach(item => {
            if (category === 'all' || item.dataset.category === category) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });
});

// Lightbox
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightbox-img');

document.querySelectorAll('.zoom-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        lightboxImg.src = btn.dataset.src;
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
    });
});

document.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
});

function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeLightbox();
});
</script>

<style>
    .gallery-hero {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        padding: 140px 0 60px;
        color: white;
    }
    .breadcrumb { display: flex; gap: 8px; margin-bottom: 20px; font-size: 0.9rem; }
    .breadcrumb a { color: rgba(255,255,255,0.7); text-decoration: none; }
    .breadcrumb span { color: rgba(255,255,255,0.5); }
    .breadcrumb span:last-child { color: white; }
    .gallery-hero h1 { font-size: clamp(2rem, 4vw, 3rem); margin-bottom: 12px; }
    .hero-subtitle { font-size: 1.2rem; color: rgba(255,255,255,0.9); }

    .filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 40px;
    }
    .filter-btn {
        padding: 10px 20px;
        border: 2px solid #e2e8f0;
        background: white;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
    }
    .filter-btn:hover { border-color: var(--primary); }
    .filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
    .gallery-item {
        position: relative;
        border-radius: var(--radius);
        overflow: hidden;
        aspect-ratio: 4/3;
    }
    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }
    .gallery-item:hover img { transform: scale(1.05); }
    .gallery-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(transparent 50%, rgba(0,0,0,0.8));
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 20px;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .gallery-item:hover .gallery-overlay { opacity: 1; }
    .gallery-caption { color: white; font-weight: 500; }
    .zoom-btn {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 44px;
        height: 44px;
        background: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .gallery-note {
        text-align: center;
        margin-top: 60px;
        padding-top: 40px;
        border-top: 1px solid #e2e8f0;
    }
    .gallery-note p { color: var(--text-muted); margin-bottom: 16px; }
    .social-links { display: flex; gap: 16px; justify-content: center; }
    .social-links a {
        width: 44px;
        height: 44px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
    }
    .social-links a:hover { background: var(--accent); }

    .lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }
    .lightbox.active { opacity: 1; visibility: visible; }
    .lightbox-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 44px;
        height: 44px;
        background: white;
        border: none;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
    }
    .lightbox img { max-width: 100%; max-height: 90vh; border-radius: var(--radius); }

    .cta-section {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        padding: 80px 0;
        text-align: center;
        color: white;
    }
    .cta-section h2 { margin-bottom: 12px; }
    .cta-section p { opacity: 0.9; margin-bottom: 32px; }
    .btn-accent { background: var(--accent); color: var(--primary-dark); }
</style>
