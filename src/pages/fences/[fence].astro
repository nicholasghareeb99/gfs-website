---
import BaseLayout from '../../layouts/BaseLayout.astro';
import site from '../../content/site.json';

// Get all fence content files
const fenceFiles = import.meta.glob('../../content/fences/*.json', { eager: true });

// Generate paths for all fence types
export function getStaticPaths() {
  return [
    { params: { fence: 'vinyl' } },
    { params: { fence: 'cedar' } },
    { params: { fence: 'wood' } },
    { params: { fence: 'aluminum' } },
    { params: { fence: 'chainlink' } },
    { params: { fence: 'split-rail' } },
  ];
}

const { fence } = Astro.params;

// Load the content for this fence type
let content;
try {
  const module = await import(`../../content/fences/${fence}.json`);
  content = module.default;
} catch {
  // Fallback content if file doesn't exist yet
  content = {
    meta: { title: `${fence} Fence - Coming Soon`, description: 'Page under construction' },
    hero: { badge: 'Coming Soon', headline: `${fence} Fence Installation`, description: 'Content coming soon.' },
    intro: { headline: 'About This Fence', content: 'Content coming soon.', benefits: [], image: '/images/gallery/vinyl-hero.jpg' },
    gallery: { headline: 'Gallery', images: [] },
    styles: { headline: 'Styles', subheadline: '', items: [] },
    pricing: { headline: 'Pricing', tiers: [] },
    cta: { headline: 'Get Started', description: 'Contact us for more information.', primaryButton: { text: 'Get Quote', href: '/quote/' }, secondaryButton: { text: 'Call Us', href: 'tel:4199028257' } }
  };
}
---

<BaseLayout title={content.meta.title} description={content.meta.description}>
    
    <!-- Hero Section -->
    <section class="hero fence-hero">
        <div class="container">
            <div class="section-label">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M7 4v16M12 4v16M17 4v16"/></svg> 
                {content.hero.badge}
            </div>
            <h1>{content.hero.headline}</h1>
            <p class="hero-description">{content.hero.description}</p>
            <div class="hero-btns">
                <a href="/quote/" class="btn btn-primary btn-lg">Get Instant Quote</a>
                <a href={`tel:${site.company.phoneRaw}`} class="btn btn-secondary btn-lg">Call {site.company.phone}</a>
            </div>
        </div>
    </section>

    <!-- Intro Section -->
    {content.intro && (
    <section class="section">
        <div class="container">
            <div class="content-with-photo">
                <div class="content-text">
                    <h2>{content.intro.headline}</h2>
                    <p>{content.intro.content}</p>
                    {content.intro.content2 && <p>{content.intro.content2}</p>}
                    {content.intro.benefits && content.intro.benefits.length > 0 && (
                    <ul class="benefits-list">
                        {content.intro.benefits.map(benefit => (
                            <li>✓ {benefit}</li>
                        ))}
                    </ul>
                    )}
                </div>
                <div class="content-photo">
                    <img src={content.intro.image} alt={content.hero.headline} loading="lazy">
                </div>
            </div>
        </div>
    </section>
    )}

    <!-- Gallery Section -->
    {content.gallery && content.gallery.images && content.gallery.images.length > 0 && (
    <section class="section section-alt">
        <div class="container">
            <h2 class="section-title">{content.gallery.headline}</h2>
            <div class="photo-grid">
                {content.gallery.images.map(img => (
                    <img src={img.src} alt={img.alt} loading="lazy">
                ))}
            </div>
        </div>
    </section>
    )}

    <!-- Styles Section -->
    {content.styles && content.styles.items && content.styles.items.length > 0 && (
    <section class="section">
        <div class="container">
            <h2 class="section-title">{content.styles.headline}</h2>
            {content.styles.subheadline && <p class="section-subtitle">{content.styles.subheadline}</p>}
            <div class="styles-grid">
                {content.styles.items.map(style => (
                    <div class="style-card">
                        <img src={style.image} alt={style.name} loading="lazy">
                        <div class="style-content">
                            <h3>{style.name}</h3>
                            <p>{style.description}</p>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>
    )}

    <!-- Visual Comparison Section -->
    {content.comparison && content.comparison.tiers && content.comparison.tiers.length > 0 && (
    <section class="section section-alt">
        <div class="container">
            <h2 class="section-title">{content.comparison.headline}</h2>
            {content.comparison.subheadline && <p class="section-subtitle">{content.comparison.subheadline}</p>}
            <div class="comparison-grid">
                {content.comparison.tiers.map(tier => (
                    <div class={`comparison-card ${tier.featured ? 'featured' : ''}`}>
                        {tier.featured && <div class="comparison-badge">MOST POPULAR</div>}
                        <div class="comparison-image">
                            <img src={tier.image} alt={tier.name} loading="lazy">
                        </div>
                        <div class="comparison-content">
                            <div class="comparison-name">{tier.name}</div>
                            <div class="comparison-subtitle">{tier.subtitle}</div>
                            <p class="comparison-desc">{tier.description}</p>
                            <a href="/quote/" class="btn btn-primary">Get Quote</a>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>
    )}

    <!-- Pricing Tiers Section (Legacy - hidden if comparison exists) -->
    {content.pricing && content.pricing.tiers && content.pricing.tiers.length > 0 && !content.comparison && (
    <section class="section section-alt">
        <div class="container">
            <h2 class="section-title">{content.pricing.headline}</h2>
            <div class="tiers-grid">
                {content.pricing.tiers.map(tier => (
                    <div class={`tier-card ${tier.featured ? 'featured' : ''}`}>
                        {tier.featured && <div class="tier-badge">MOST POPULAR</div>}
                        <div class="tier-name">{tier.name}</div>
                        {tier.subtitle && <div class="tier-subtitle">{tier.subtitle}</div>}
                        <div class="tier-price">{tier.priceRange} <small>/linear ft</small></div>
                        <ul class="tier-features">
                            {tier.features.map(feature => (
                                <li>{feature}</li>
                            ))}
                        </ul>
                        <a href="/quote/" class="btn btn-primary">Get Quote</a>
                    </div>
                ))}
            </div>
        </div>
    </section>
    )}

    <!-- CTA Section -->
    <section class="section cta-section">
        <div class="container" style="text-align: center;">
            <h2 class="section-title">{content.cta.headline}</h2>
            <p class="section-subtitle">{content.cta.description}</p>
            <div class="cta-buttons">
                <a href={content.cta.primaryButton.href} class="btn btn-primary btn-lg">{content.cta.primaryButton.text}</a>
                <a href={content.cta.secondaryButton.href} class="btn btn-secondary btn-lg">{content.cta.secondaryButton.text}</a>
            </div>
        </div>
    </section>

    <!-- Material Comparison Section (Cedar vs PT Pine) -->
    {content.materialComparison && (
    <section class="section section-alt">
        <div class="container">
            <h2 class="section-title">{content.materialComparison.headline}</h2>
            <p class="section-subtitle">{content.materialComparison.subheadline}</p>
            <div class="material-comparison-grid">
                {content.materialComparison.materials.map(material => (
                    <div class={`material-card ${material.name.toLowerCase().includes('cedar') ? 'recommended' : ''}`}>
                        {material.name.toLowerCase().includes('cedar') && <div class="recommended-badge">✓ Recommended</div>}
                        <h3 class="material-name">{material.name}</h3>
                        <ul class="material-features">
                            {material.features.map(feature => (
                                <li><span class="feature-icon">{material.icon}</span> {feature}</li>
                            ))}
                        </ul>
                        <div class="material-verdict">{material.verdict}</div>
                    </div>
                ))}
            </div>
            {content.materialComparison.bottomLine && (
            <div class="comparison-stats">
                <h4>{content.materialComparison.bottomLine.text}</h4>
                <div class="stats-row">
                    {content.materialComparison.bottomLine.stats.map(stat => (
                        <div class="stat-item">
                            <div class="stat-value">{stat.value}</div>
                            <div class="stat-label">{stat.label}</div>
                        </div>
                    ))}
                </div>
            </div>
            )}
        </div>
    </section>
    )}

</BaseLayout>

<style>
    .fence-hero {
        background: linear-gradient(135deg, #1e3a5f, #0f172a);
        padding: 140px 0 80px;
    }
    .fence-hero h1 {
        color: white;
        font-size: clamp(2.5rem, 5vw, 3.5rem);
        margin-bottom: 16px;
    }
    .hero-description {
        color: rgba(255,255,255,0.9);
        font-size: 1.2rem;
        max-width: 600px;
        margin-bottom: 32px;
    }
    
    .content-with-photo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        align-items: center;
    }
    .content-text h2 { margin-bottom: 16px; }
    .content-text p { color: var(--text-sub); margin-bottom: 16px; line-height: 1.7; }
    .benefits-list { list-style: none; padding: 0; }
    .benefits-list li { padding: 8px 0; color: var(--text); }
    .content-photo img { width: 100%; border-radius: 12px; height: 350px; object-fit: cover; }
    
    .section-alt { background: var(--dark-card); }
    
    .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
        margin-top: 32px;
    }
    .photo-grid img { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
    
    .styles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-top: 40px;
    }
    .style-card {
        background: var(--dark-card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
    }
    .style-card img { width: 100%; height: 180px; object-fit: cover; }
    .style-content { padding: 20px; }
    .style-content h3 { margin-bottom: 8px; }
    .style-content p { color: var(--text-sub); font-size: 0.9rem; }
    
    .tiers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        margin-top: 40px;
    }
    .tier-card {
        background: var(--dark);
        border-radius: 12px;
        padding: 32px;
        text-align: center;
        border: 2px solid var(--border);
        position: relative;
    }
    .tier-card.featured { border-color: var(--accent); }
    .tier-badge {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--accent);
        color: var(--primary);
        font-size: 0.7rem;
        padding: 4px 16px;
        border-radius: 12px;
        font-weight: 700;
    }
    .tier-name { font-size: 1.3rem; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
    .tier-subtitle { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 8px; }
    .tier-price { font-size: 2rem; font-weight: 800; color: white; }
    .tier-price small { font-size: 0.9rem; font-weight: 400; opacity: 0.7; }
    .tier-features { list-style: none; padding: 0; margin: 24px 0; text-align: left; }
    .tier-features li {
        padding: 8px 0;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text);
    }
    .tier-features li::before { content: '✓'; color: var(--accent); font-weight: bold; }
    
    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-top: 40px;
    }
    .comparison-card {
        background: var(--dark);
        border-radius: 16px;
        overflow: hidden;
        border: 2px solid var(--border);
        position: relative;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .comparison-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.3);
    }
    .comparison-card.featured { border-color: var(--accent); }
    .comparison-badge {
        position: absolute;
        top: 16px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--accent);
        color: var(--primary);
        font-size: 0.7rem;
        padding: 6px 16px;
        border-radius: 20px;
        font-weight: 700;
        z-index: 10;
    }
    .comparison-image {
        width: 100%;
        height: 220px;
        overflow: hidden;
    }
    .comparison-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }
    .comparison-card:hover .comparison-image img {
        transform: scale(1.05);
    }
    .comparison-content {
        padding: 24px;
        text-align: center;
    }
    .comparison-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 4px;
    }
    .comparison-subtitle {
        font-size: 1rem;
        color: white;
        font-weight: 600;
        margin-bottom: 12px;
    }
    .comparison-desc {
        color: var(--text-sub);
        font-size: 0.9rem;
        line-height: 1.6;
        margin-bottom: 20px;
    }
    
    .cta-section { background: linear-gradient(135deg, var(--primary), #0f172a); }
    .cta-buttons { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 32px; }
    
    /* Material Comparison Styles */
    .material-comparison-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        margin-top: 32px;
    }
    .material-card {
        background: var(--dark-card);
        border: 2px solid var(--border);
        border-radius: 16px;
        padding: 32px;
        position: relative;
    }
    .material-card.recommended {
        border-color: var(--accent);
        background: linear-gradient(135deg, rgba(212,175,55,0.1), rgba(212,175,55,0.05));
    }
    .recommended-badge {
        position: absolute;
        top: -12px;
        right: 20px;
        background: var(--accent);
        color: var(--primary);
        font-size: 0.75rem;
        padding: 6px 14px;
        border-radius: var(--radius-full);
        font-weight: 700;
    }
    .material-name {
        font-size: 1.3rem;
        color: white;
        margin-bottom: 20px;
        text-align: center;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border);
    }
    .material-features {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .material-features li {
        padding: 10px 0;
        color: var(--text-sub);
        font-size: 0.9rem;
        display: flex;
        align-items: flex-start;
        gap: 10px;
    }
    .feature-icon {
        flex-shrink: 0;
    }
    .material-verdict {
        margin-top: 20px;
        padding: 12px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        text-align: center;
        color: var(--accent);
        font-weight: 600;
    }
    .comparison-stats {
        margin-top: 40px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        border-radius: 16px;
        padding: 32px;
        text-align: center;
    }
    .comparison-stats h4 {
        color: white;
        margin-bottom: 24px;
        font-size: 1.2rem;
    }
    .stats-row {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
    }
    .stat-item {
        text-align: center;
    }
    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--accent);
    }
    .stat-label {
        font-size: 0.85rem;
        color: rgba(255,255,255,0.8);
        margin-top: 4px;
    }
    
    @media (max-width: 768px) {
        .content-with-photo { grid-template-columns: 1fr; }
        .material-comparison-grid { grid-template-columns: 1fr; }
    }
</style>
